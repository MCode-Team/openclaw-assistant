# Debug Guide - Speech Recognition Troubleshooting

## Problem Description

Recognized commands are not executing.

## Completed Fixes

### 1. Audio Format Issue
**Problem**: The WebM format generated by MediaRecorder is not suitable for direct sending to Deepgram.
**Solution**: Switched to using AudioContext + ScriptProcessorNode to obtain raw PCM data.

### 2. Audio Processing Flow
```
Microphone → AudioContext → ScriptProcessorNode → 16-bit PCM → Deepgram
```

### 3. Added Debug Logs
- Backend prints received transcription data.
- Frontend prints recording startup information.

## Current Test Steps

1. **Open Application** (Automatically started in development mode)
2. **Open Developer Tools** (Should open automatically)
3. **Click Microphone Icon**
4. **Speak Test**: "Any emails today?"

## View Logs

### Frontend Logs (Chrome DevTools Console)
You should see:
```
Deepgram Connected
Recording started, audio processing initiated
Recognizing: [real-time recognition content]
Recognition result: [final recognition result]
```

### Backend Logs (Terminal)
You should see:
```
Deepgram connection established
Received transcription data: {...}
Transcription result: "Any emails today?", isFinal: true
```

## Common Issues

### 1. "Recording started" not seen
- Check microphone permissions.
- Check Console for errors.

### 2. "Recording started" seen but no recognition results
- Check network connection.
- Confirm Deepgram API Key is valid.
- Check backend logs for errors.

### 3. Recognition results exist but commands not executing
- Check if handleCommand function is called.
- View "Recognition result" in Console logs.
- Confirm command contains keywords ("email", "briefing", "today").

## Manual Test Commands

If there are issues with speech recognition, you can test manually in the Console:

```javascript
// Test email command
handleCommand("Any emails today?")

// Test schedule command
handleCommand("What's my schedule today?")
```

## Technical Details

### Audio Parameters
- Sample Rate: 16000 Hz
- Channels: Mono
- Format: 16-bit PCM
- Buffer Size: 4096 samples

### Deepgram Configuration
- Model: nova-2
- Language: en-US (or zh-CN if still targeting Chinese)
- Real-time Results: Enabled
- Smart Formatting: Enabled

## Next Steps

If the problem persists:
1. View complete Console logs.
2. View complete backend logs.
3. Check Deepgram console usage.
4. Try simple English tests: "hello"

## Alternatives

If Deepgram still has issues, consider:
1. Using Alibaba Cloud Speech Recognition.
2. Using iFLYTEK Speech Recognition.
3. Using OpenAI Whisper API.
